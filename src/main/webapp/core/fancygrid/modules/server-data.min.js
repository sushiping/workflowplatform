Fancy.Mixin("Fancy.store.mixin.Proxy",{pageParam:"page",startParam:"start",limitParam:"limit",sortParam:"sort",directionParam:"dir",keyParam:"key",valueParam:"value",filterParam:"filter",filterOperators:{"<":"lt",">":"gt","<=":"lteq",">=":"gteq","=":"eq","==":"eq","===":"stricteq","!=":"noteq","!==":"notstricteq","":"like"},initProxy:function(){var a=this;a.proxy=a.data.proxy||{},a.initReader(),a.initWriter(),"rest"===a.proxy.type?a.initRest():(a.initServerAPI(),a.initActionMethods(),a.checkProxy()),a.loadData()},checkProxy:function(){var a=this,b=a.proxy;if(void 0===b.api.read)throw new Error("[FancyGrid Error] - in data proxy there is not url")},checkUrl:function(){var a=this,b=a.proxy;if(void 0===b.url)throw new Error("[FancyGrid Error] - in data proxy there is not url")},initServerAPI:function(){var a=this,b=a.proxy;b.api=b.api||{},b.url&&(b.api.read=b.url),b.api.update&&(a.proxyType="server")},initActionMethods:function(){var a=this,b=a.proxy,c=b.methods||{},d=b.method||"GET";c.create=c.create||d,c.read=c.read||d,c.update=c.update||d,c.destroy=c.destroy||d,b.methods=c},loadData:function(){var a,b=this,c=b.proxy,d=b.params||{};b.fire("beforeload"),"server"===b.pageType&&(d[b.pageParam]=b.showPage,d[b.limitParam]=b.pageSize,d[b.startParam]=b.showPage*b.pageSize),b.loading=!0,Fancy.Ajax({url:c.api.read,method:c.methods.read,params:d,dataType:a,getJSON:!0,success:function(a){b.loading=!1,b.defineModel(a[b.readerRootProperty]),b.paging?b.processPagingData(a):(b.setData(a[b.readerRootProperty]),b.widget.setSidesHeight()),b.fire("change"),b.fire("load")}})},proxyCRUD:function(a,b,c,d){var e=this;switch(a){case"UPDATE":e.proxyServerUpdate(b,c,d);break;case"DESTROY":e.proxyServerDestroy(b);break;case"CREATE":e.proxyServerCreate(b)}},proxyServerUpdate:function(a,b,c){var d=this,e=d.params||{},f=d.proxy,g="json"===d.writerType;g?e=d.prepareWriterJSONParams(a,b,c):(e.id=a,e[d.keyParam]=b,e[d.valueParam]=c,e.action="update"),d.loading=!0,d.fire("beforeupdate",a,b,c),Fancy.Ajax({url:f.api.update,method:f.methods.update,params:e,sendJSON:g,success:function(e){d.loading=!1,d.fire("update",a,b,c)}})},proxyServerDestroy:function(a){var b=this,c=b.params||{},d=b.proxy,e="json"===b.writerType;c.id=a,b.loading=!0,b.fire("beforedestroy"),Fancy.Ajax({url:d.api.destroy,method:d.methods.destroy,params:c,sendJSON:e,success:function(c){b.loading=!1,b.fire("destroy",a)}})},proxyServerCreate:function(a){var b=this,c=b.params||{},d=b.proxy,e="json"===b.writerType;c.id=a.id,void 0===c.id&&delete c.id,b.loading=!0,b.fire("beforecreate"),Fancy.Ajax({url:d.api.create,method:d.methods.create,params:c,sendJSON:e,success:function(a){b.loading=!1,b.fire("create",a.data)}})}}),Fancy.Mixin("Fancy.store.mixin.Rest",{initRest:function(){var a=this;a.proxyType="server",a.checkUrl(),a.initRestServerAPI(),a.initRestActionMethods()},initRestServerAPI:function(){var a=this,b=a.proxy,c=b.url;b.api=b.api||{},b.api.create=c,b.api.read=c,b.api.update=c,b.api.destroy=c},initRestActionMethods:function(){var a=this,b=a.proxy,c=b.methods||{};c.create=c.create||b.method||"POST",c.read=c.read||b.method||"GET",c.update=c.update||b.method||"PUT",c.destroy=c.destroy||b.method||"DELETE",b.methods=c}}),Fancy.Mixin("Fancy.store.mixin.Reader",{readerType:"json",readerRootProperty:"data",initReader:function(){var a=this,b=a.proxy;b.reader&&a.configReader(b.reader)},configReader:function(a){var b=this;switch(Fancy.typeOf(a)){case"string":switch(a){case"json":b.readerType=a;break;default:throw new Error("[FancyGrid Error] - reader "+a+" does not exist")}break;case"object":switch(a.type){case void 0:b.readerType="json";break;case"json":b.readerType=a.type;break;default:throw new Error("[FancyGrid Error] - reader "+a.type+" does not exist")}a.root&&(b.readerRootProperty=a.root)}}}),Fancy.Mixin("Fancy.store.mixin.Writer",{writerType:"string",initWriter:function(){var a=this,b=a.proxy;b.writer&&a.configWriter(b.writer)},configWriter:function(a){var b=this;switch(Fancy.typeOf(a)){case"string":switch(a){case"json":case"string":b.writerType=a;break;default:throw new Error("[FancyGrid Error] - writer "+a.type+" does not exist")}break;case"object":switch(a.type){case void 0:b.writerType="string";break;case"json":case"string":b.writerType=a.type;break;default:throw new Error("[FancyGrid Error] - writer "+a+" does not exist")}a.writeFields&&(b.writeFields=!0),a.root&&(b.writerRootProperty=a.root)}},prepareWriterJSONParams:function(a,b,c){var d=this,e=d.params||{},f={};return f.id=a,f[b]=c,d.rootProperty?(e[d.rootProperty]=f,e):f}});